import{n as _,r as b,o as d,q as m,t as u,v as p,w as l,x as g,y as k,z as y,A,B as w,E,C as T,H as F,F as x,G as M,I as v}from"./CM1phM2d.js";class R{anchor;#s=new Map;#t=new Map;#e=new Map;#a=new Set;#i=!0;constructor(e,a=!0){this.anchor=e,this.#i=a}#r=()=>{var e=_;if(this.#s.has(e)){var a=this.#s.get(e),s=this.#t.get(a);if(s)b(s),this.#a.delete(a);else{var f=this.#e.get(a);f&&(this.#t.set(a,f.effect),this.#e.delete(a),f.fragment.lastChild.remove(),this.anchor.before(f.fragment),s=f.effect)}for(const[i,t]of this.#s){if(this.#s.delete(i),i===e)break;const r=this.#e.get(t);r&&(d(r.effect),this.#e.delete(t))}for(const[i,t]of this.#t){if(i===a||this.#a.has(i))continue;const r=()=>{if(Array.from(this.#s.values()).includes(i)){var h=document.createDocumentFragment();k(t,h),h.append(u()),this.#e.set(i,{effect:t,fragment:h})}else d(t);this.#a.delete(i),this.#t.delete(i)};this.#i||!s?(this.#a.add(i),m(t,r,!1)):r()}}};#f=e=>{this.#s.delete(e);const a=Array.from(this.#s.values());for(const[s,f]of this.#e)a.includes(s)||(d(f.effect),this.#e.delete(s))};ensure(e,a){var s=_,f=y();if(a&&!this.#t.has(e)&&!this.#e.has(e))if(f){var i=document.createDocumentFragment(),t=u();i.append(t),this.#e.set(e,{effect:p(()=>a(t)),fragment:i})}else this.#t.set(e,p(()=>a(this.anchor)));if(this.#s.set(s,e),f){for(const[r,n]of this.#t)r===e?s.skipped_effects.delete(n):s.skipped_effects.add(n);for(const[r,n]of this.#e)r===e?s.skipped_effects.delete(n.effect):s.skipped_effects.add(n.effect);s.oncommit(this.#r),s.ondiscard(this.#f)}else l&&(this.anchor=g),this.#r()}}function B(c,e,a=!1){l&&w();var s=new R(c),f=a?E:0;function i(t,r){if(l){const h=T(c)===F;if(t===h){var n=x();M(n),s.anchor=n,v(!1),s.ensure(t,r),v(!0);return}}s.ensure(t,r)}A(()=>{var t=!1;e((r,n=!0)=>{t=!0,i(n,r)}),t||i(!1,null)},f)}let o=!1;function C(c){var e=o;try{return o=!1,[c(),o]}finally{o=e}}export{R as B,C as c,B as i};
